<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Baca Data Nasabah (via API Online)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9fafb; color: #222; }
    h1 { margin-top: 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; }
    th { background: #f2f2f2; text-align: left; }
    .right { text-align: right; }
    button { margin-top: 10px; padding: 8px 12px; border: none; border-radius: 6px; background: #007bff; color: white; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <h1>ðŸ“‹ Data Nasabah</h1>
  <p>Data diambil dari <b>https://laporan.infinityfreeapp.com/api/read.php</b></p>

  <table id="tblNasabah">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Username</th>
        <th>Alamat</th>
        <th>No HP</th>
        <th class="right">Saldo</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="6" style="text-align:center">Memuat data...</td></tr>
    </tbody>
  </table>

  <button id="btnReload">ðŸ”„ Muat Ulang</button>

  <script>
  const API_URL = "https://laporan.infinityfreeapp.com/api/read.php";

  async function loadNasabah() {
    const tbody = document.querySelector("#tblNasabah tbody");
    tbody.innerHTML = `<tr><td colspan="6" style="text-align:center">Memuat data...</td></tr>`;

    try {
      const res = await fetch(API_URL, {
        method: "GET",
        headers: { "Content-Type": "application/json" }
      });

      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      const text = await res.text();

      let data;
      try {
        data = JSON.parse(text);
      } catch (e) {
        console.error("Respon bukan JSON:", text);
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:red">Respon tidak valid</td></tr>`;
        return;
      }

      if (!Array.isArray(data)) {
        console.warn("Data bukan array:", data);
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:red">Format data tidak valid</td></tr>`;
        return;
      }

      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center">Tidak ada data nasabah</td></tr>`;
        return;
      }

      tbody.innerHTML = "";
      data.forEach((n, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${n.nama || "-"}</td>
          <td>${n.username || "-"}</td>
          <td>${n.alamat || "-"}</td>
          <td>${n.no_hp || "-"}</td>
          <td class="right">${Number(n.saldo || 0).toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error("Gagal memuat nasabah:", err);
      tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:red">Gagal memuat data (${err.message})</td></tr>`;
    }
  }

  document.getElementById("btnReload").addEventListener("click", loadNasabah);
  document.addEventListener("DOMContentLoaded", loadNasabah);
  </script>
</body>
</html>
